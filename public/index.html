<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitcoin Bro Maker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-black">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Bitcoin Bro Maker</h1>

    <div class="grid grid-cols-6">
        <div class="col-span-3">
            <form id="bro-form" class="bg-white p-4 rounded shadow-md mr-4">
              <div class="flex flex-wrap mb-4">
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                  <label class="block mb-2 font-bold" for="background">Background:</label>
                  <select onchange="generateBro()" id="background" name="background" class="block w-full p-2 border border-gray-300 rounded">
                  </select>
                  <label for="background-fixed">Fixed?</label>
                  <input id="background-fixed" type="checkbox">
                </div>  
                
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                  <label class="block mb-2 font-bold" for="skin">Skin:</label>
                  <select onchange="generateBro()" id="skin" name="skin" class="block w-full p-2 border border-gray-300 rounded">
                  </select>
                  <label for="skin-fixed">Fixed?</label>
                  <input id="skin-fixed" type="checkbox">
                </div>
              </div>
              
              <div class="flex flex-wrap mb-4">
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="dress">Dress:</label>
                <select onchange="generateBro()" id="dress" name="dress" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="dress-fixed">Fixed?</label>
                <input id="dress-fixed" type="checkbox">
              </div>
        
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="face">Face:</label>
                <select onchange="generateBro()" id="face" name="face" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="face-fixed">Fixed?</label>
                <input id="face-fixed" type="checkbox">
              </div>
        
              </div>

              <div class="flex flex-wrap mb-4">
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="head">Head:</label>
                <select onchange="generateBro()" id="head" name="head" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="head-fixed">Fixed?</label>
                <input id="head-fixed" type="checkbox">
              </div>
        
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="eyes">Eyes:</label>
                <select onchange="generateBro()" id="eyes" name="eyes" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="eyes-fixed">Fixed?</label>
                <input id="eyes-fixed" type="checkbox">
              </div>
        </div>

        <div class="flex flex-wrap mb-4">
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="eyewear">Eyewear:</label>
                <select onchange="generateBro()" id="eyewear" name="eyewear" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="eyewear-fixed">Fixed?</label>
                <input id="eyewear-fixed" type="checkbox">
              </div>
        
              <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block mb-2 font-bold" for="beard">Beard:</label>
                <select onchange="generateBro()" id="beard" name="beard" class="block w-full p-2 border border-gray-300 rounded">
                </select>
                <label for="beard-fixed">Fixed?</label>
                <input id="beard-fixed" type="checkbox">
              </div>
        </div>
              <button id="generate-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="generateBro()">Generate Bro</button>
              <button id="random-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="randomBro()">Randomise</button>
            </form>
        </div>
        <div class="col-span-3" style="max-width: 500px;">
            <div id="result" class="mb-4">
              
              </div>
              <div>
                <a id="download-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" style="margin-top: 10px; display: none; margin: 0 auto; width: 150px; text-align: center;" onclick="download()" download="bro.png">Download</a>
              </div>
        </div>
    </div>
  </div>
  <script>

      // Assuming you have an array of folder names
  const traitNames = ['background', 'beard', 'dress', 'eyes', 'eyewear', 'face', 'head', 'skin'];

  // Function to read a CSV file and return its contents as an array
  function readCSV(file) {
    // Replace this with your own CSV reading logic
    // Here's a simplified example assuming the CSV is already loaded as a string
    const csvString = file;
    const lines = csvString.split('\n');
    return lines.map(line => line.trim());
  }

  // Function to populate a select element with options
  function populateSelect(selectId, options) {
    const select = document.getElementById(selectId);
    options.forEach((option, index) => {
      const optionElement = document.createElement('option');
      optionElement.text = option;
      optionElement.value = option;
      select.add(optionElement);
    });
    document.getElementById(selectId).options[0].setAttribute('selected', '');
  }

  window.onload = traitNames.forEach(folderName => {
    // Replace 'csvFiles/folderName.csv' with the actual file path
    fetch(`assets/${folderName}/list.csv`)
      .then(response => response.text())
      .then(csvData => {
        const options = readCSV(csvData);
        populateSelect(folderName, options);
      })
      .catch(error => {
        console.error(`Error loading CSV file for ${folderName}:`, error);
      });
      generateBro();
  });

    function randomBro() {
      traitNames.forEach(function(trait) {
        if(!document.getElementById(trait+'-fixed').checked) {
          const selectElement = document.getElementById(trait);
          const options = selectElement.options;

          const randomIndex = Math.floor(Math.random() * options.length);

          document.getElementById(trait).options[randomIndex].setAttribute('selected', '');
        }
      })
      generateBro();
    }

    const downloadLink = document.getElementById('download-btn');
    downloadLink.addEventListener('click', () => {
      const img = document.querySelector('#result img');
      if (img && img.src) {
        downloadLink.href = img.src;
      }
    });

    function generateBro() {
      document.getElementById('download-btn').style.display = 'block';
      const formData = new FormData(document.getElementById('bro-form'));
      const params = new URLSearchParams(formData).toString();

  // Adjust the API endpoint URL accordingly
  const apiUrl = 'http://localhost:3000/generate?' + params;

  fetch(apiUrl)
  .then(response => response.json())
  .then(data => {
    // Render PNG data URL
    document.getElementById('result').innerHTML = `<img src="${data.bro}" alt="bro" style="width: 500px; height: 500px;"/>`;
  })
  .catch(error => {
    // Handle any errors that occurred during the request
    console.error(error);
  });
    }
  </script>
</body>

</html>